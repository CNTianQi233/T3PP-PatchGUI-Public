<ui:FluentWindow x:Class="PatchGUI.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:local="clr-namespace:PatchGUI"
                 xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
                 xmlns:sys="clr-namespace:System;assembly=mscorlib"
                 Title="汉化补丁器"
                 Width="840" Height="720"
                 MinWidth="640" MinHeight="520"
                 ExtendsContentIntoTitleBar="True"
                 WindowBackdropType="Mica"
                 WindowCornerPreference="Round"
                 WindowStartupLocation="CenterScreen">
    
    <ui:FluentWindow.TaskbarItemInfo>
        <shell:TaskbarItemInfo x:Name="MainTaskbarItemInfo"
                               ProgressState="None"
                               ProgressValue="0" />
    </ui:FluentWindow.TaskbarItemInfo>

    <ui:FluentWindow.Resources>
        <ResourceDictionary>

            <!-- ========== 缓动函数 ========== -->
            <QuinticEase x:Key="SmoothEase" EasingMode="EaseOut"/>
            <CubicEase x:Key="SubtleEase" EasingMode="EaseInOut"/>

            <!-- ========== 高级按钮样式 ========== -->
            <Style x:Key="AnimatedButtonStyle"
                   TargetType="ui:Button"
                   BasedOn="{StaticResource {x:Type ui:Button}}">
                <Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <TransformGroup>
                            <ScaleTransform ScaleX="1" ScaleY="1" />
                        </TransformGroup>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <!-- 悬停：微微放大（仅跟随鼠标移入/移出） -->
                    <Trigger Property="IsMouseOver" Value="True">
                        <Trigger.EnterActions>
                            <BeginStoryboard HandoffBehavior="SnapshotAndReplace">
                                <Storyboard>
                                     <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Children[0].ScaleX"
                                                     To="1.05" Duration="0:0:0.18">
                                        <DoubleAnimation.EasingFunction>
                                            <QuinticEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                     <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Children[0].ScaleY"
                                                     To="1.05" Duration="0:0:0.18">
                                        <DoubleAnimation.EasingFunction>
                                            <QuinticEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.EnterActions>
                        <Trigger.ExitActions>
                            <BeginStoryboard HandoffBehavior="SnapshotAndReplace">
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Children[0].ScaleX"
                                                     To="1.0" Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Children[0].ScaleY"
                                                     To="1.0" Duration="0:0:0.2">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.ExitActions>
                    </Trigger>
                </Style.Triggers>
            </Style>

            <!-- ========== 导航按钮样式（带悬停背景） ========== -->
            <Style x:Key="NavRadioButtonStyle" TargetType="RadioButton">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource NavTextBrush}"/>
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="FontWeight" Value="Normal"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Margin" Value="0,0,4,0"/>
                <Setter Property="Padding" Value="14,8"/>
                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="RadioButton">
                            <Border x:Name="RootBorder"
                                    Background="{TemplateBinding Background}"
                                    Padding="{TemplateBinding Padding}"
                                    CornerRadius="6">
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{DynamicResource NavHoverBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                </Trigger>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ========== 高级卡片样式 ========== -->
            <Style x:Key="ElevatedCardStyle" TargetType="Border">
                <Setter Property="CornerRadius" Value="12"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="BorderBrush" Value="{DynamicResource CardBorderBrush}"/>
                <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect ShadowDepth="2" BlurRadius="8" Opacity="0.08" Direction="270"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <!-- ========== 复选框样式 ========== -->
            <Style x:Key="AnimatedCheckBoxStyle" TargetType="CheckBox">
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Cursor" Value="Hand"/>
                <Setter Property="Margin" Value="0,6,0,0"/>
                <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}"/>
                <Setter Property="RenderTransformOrigin" Value="0,0.5"/>
                <Setter Property="RenderTransform">
                    <Setter.Value>
                        <ScaleTransform ScaleX="1" ScaleY="1"/>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Trigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                                                     To="1.02" Duration="0:0:0.15">
                                        <DoubleAnimation.EasingFunction>
                                            <QuinticEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                                                     To="1.02" Duration="0:0:0.15">
                                        <DoubleAnimation.EasingFunction>
                                            <QuinticEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.EnterActions>
                        <Trigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleX)"
                                                     To="1.0" Duration="0:0:0.15">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                    <DoubleAnimation Storyboard.TargetProperty="RenderTransform.(ScaleTransform.ScaleY)"
                                                     To="1.0" Duration="0:0:0.15">
                                        <DoubleAnimation.EasingFunction>
                                            <CubicEase EasingMode="EaseOut"/>
                                        </DoubleAnimation.EasingFunction>
                                    </DoubleAnimation>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.ExitActions>
                    </Trigger>
                    <Trigger Property="IsChecked" Value="True">
                        <Setter Property="FontWeight" Value="Medium"/>
                        <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>

        </ResourceDictionary>
    </ui:FluentWindow.Resources>

    <Grid x:Name="RootGrid" Background="{DynamicResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <ui:TitleBar Grid.Row="0"
                     x:Name="WindowTitleBar"
                     Title="汉化补丁器"
                     ShowMinimize="True"
                     ShowMaximize="True"
                     ShowClose="True" />

        <!-- 主布局 -->
        <Grid Grid.Row="1" Margin="24,0,24,24">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 顶部：游戏选择 + 导航 + 当前游戏 -->
            <StackPanel Grid.Row="0"
                        Orientation="Vertical"
                        Margin="0,0,0,15"
                        ClipToBounds="False">

                <!-- "补丁 / 生成 / 设置" 导航 -->
                <Grid x:Name="DebugNavBar"
                      HorizontalAlignment="Left"
                      Margin="4,-2,0,10"
                      Visibility="Visible">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel x:Name="NavTabPanel" Grid.Row="0" Orientation="Horizontal">
                        <!-- 补丁 -->
                        <RadioButton x:Name="PatchTabRadio"
                                     Content="补丁"
                                     IsChecked="True"
                                     Checked="NavTab_Checked"
                                     Style="{StaticResource NavRadioButtonStyle}">
                            <RadioButton.Triggers>
                                <EventTrigger RoutedEvent="RadioButton.Checked">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 进入动画：PatchView -->
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PatchView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimation Storyboard.TargetName="PatchView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             From="0" To="1"
                                                             Duration="0:0:0.25">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="PatchViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             From="12" To="0"
                                                             Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <!-- 退出动画：GenerateView -->
                                            <DoubleAnimation Storyboard.TargetName="GenerateView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="GenerateViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GenerateView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：SettingsView -->
                                            <DoubleAnimation Storyboard.TargetName="SettingsView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="SettingsViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SettingsView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：KeysViewHost -->
                                            <DoubleAnimation Storyboard.TargetName="KeysViewHost"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="KeysViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="KeysViewHost"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GameSelectionPanel"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </RadioButton.Triggers>
                        </RadioButton>

                        <!-- 生成补丁 -->
                        <RadioButton x:Name="GenerateTabRadio"
                                     Content="生成补丁"
                                     Checked="NavTab_Checked"
                                     Style="{StaticResource NavRadioButtonStyle}">
                            <RadioButton.Triggers>
                                <EventTrigger RoutedEvent="RadioButton.Checked">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 进入动画：GenerateView -->
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GenerateView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimation Storyboard.TargetName="GenerateView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             From="0" To="1"
                                                             Duration="0:0:0.25">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="GenerateViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             From="12" To="0"
                                                             Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <!-- 退出动画：PatchView -->
                                            <DoubleAnimation Storyboard.TargetName="PatchView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="PatchViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PatchView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：SettingsView -->
                                            <DoubleAnimation Storyboard.TargetName="SettingsView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="SettingsViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SettingsView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：KeysViewHost -->
                                            <DoubleAnimation Storyboard.TargetName="KeysViewHost"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="KeysViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="KeysViewHost"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GameSelectionPanel"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </RadioButton.Triggers>
                        </RadioButton>

                        <!-- 规则 -->


                        <!-- 密钥 (Key Derivation) -->
                        <RadioButton x:Name="KeysTabRadio"
                                     Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[nav.keys]}"
                                     Checked="NavTab_Checked"
                                     Style="{StaticResource NavRadioButtonStyle}">
                            <RadioButton.Triggers>
                                <EventTrigger RoutedEvent="RadioButton.Checked">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 进入动画：KeysViewHost -->
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="KeysViewHost"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimation Storyboard.TargetName="KeysViewHost"
                                                             Storyboard.TargetProperty="Opacity"
                                                             From="0" To="1"
                                                             Duration="0:0:0.25">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="KeysViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             From="12" To="0"
                                                             Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <!-- 退出动画：PatchView -->
                                            <DoubleAnimation Storyboard.TargetName="PatchView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="PatchViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PatchView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：GenerateView -->
                                            <DoubleAnimation Storyboard.TargetName="GenerateView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="GenerateViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GenerateView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：SettingsView -->
                                            <DoubleAnimation Storyboard.TargetName="SettingsView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="SettingsViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SettingsView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GameSelectionPanel"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </RadioButton.Triggers>
                        </RadioButton>

                        <!-- 设置 -->
                        <RadioButton x:Name="SettingsTabRadio"
                                     Content="设置"
                                     Checked="NavTab_Checked"
                                     Style="{StaticResource NavRadioButtonStyle}">
                            <RadioButton.Triggers>
                                <EventTrigger RoutedEvent="RadioButton.Checked">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 进入动画：SettingsView -->
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="SettingsView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Visible}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                            <DoubleAnimation Storyboard.TargetName="SettingsView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             From="0" To="1"
                                                             Duration="0:0:0.25">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="SettingsViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             From="12" To="0"
                                                             Duration="0:0:0.3">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseOut"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>

                                            <!-- 退出动画：PatchView -->
                                            <DoubleAnimation Storyboard.TargetName="PatchView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="PatchViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="PatchView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：GenerateView -->
                                            <DoubleAnimation Storyboard.TargetName="GenerateView"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="GenerateViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GenerateView"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <!-- 退出动画：KeysViewHost -->
                                            <DoubleAnimation Storyboard.TargetName="KeysViewHost"
                                                             Storyboard.TargetProperty="Opacity"
                                                             To="0" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation Storyboard.TargetName="KeysViewTranslate"
                                                             Storyboard.TargetProperty="Y"
                                                             To="-8" Duration="0:0:0.15">
                                                <DoubleAnimation.EasingFunction>
                                                    <QuadraticEase EasingMode="EaseIn"/>
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="KeysViewHost"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.15" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>

                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="GameSelectionPanel"
                                                                           Storyboard.TargetProperty="Visibility">
                                                <DiscreteObjectKeyFrame KeyTime="0" Value="{x:Static Visibility.Collapsed}"/>
                                            </ObjectAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </RadioButton.Triggers>
                        </RadioButton>
                    </StackPanel>

                    <!-- 滑动指示条 -->
                    <Border x:Name="NavIndicator"
                            Grid.Row="1"
                            Height="3"
                            Width="36"
                            Margin="0,4,0,0"
                            HorizontalAlignment="Left"
                            Background="#0078D7"
                            CornerRadius="1.5">
                        <Border.RenderTransform>
                            <TranslateTransform x:Name="NavIndicatorTranslate" X="0"/>
                        </Border.RenderTransform>
                    </Border>
                </Grid>
            </StackPanel>

            <!-- 三个视图 -->
            <Grid Grid.Row="1">

                <!-- 补丁页 -->
                <Grid x:Name="PatchView" Visibility="Visible" Opacity="1">
                    <Grid.RenderTransform>
                        <TranslateTransform x:Name="PatchViewTranslate" Y="0"/>
                    </Grid.RenderTransform>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="12"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 顶部：目录选择 & 执行补丁 & 恢复备份 -->
                         <Grid Grid.Row="0"
                               x:Name="PatchControlsPanel">
                             <Grid.RowDefinitions>
                                 <RowDefinition Height="Auto"/>
                                 <RowDefinition Height="10"/>
                                 <RowDefinition Height="Auto"/>
                                 <RowDefinition Height="10"/>
                                 <RowDefinition Height="Auto"/>
                             </Grid.RowDefinitions>
                             <Grid.ColumnDefinitions>
                                 <ColumnDefinition Width="Auto"/>
                                 <!-- 0 选择目录 -->
                                 <ColumnDefinition Width="10"/>
                            <!-- 1 间隔 -->
                            <ColumnDefinition Width="*"/>
                            <!-- 2 路径框 -->
                            <ColumnDefinition Width="10"/>
                            <!-- 3 间隔 -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- 4 执行补丁 -->
                            <ColumnDefinition Width="10"/>
                            <!-- 5 间隔 -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- 6 恢复备份 -->
                        </Grid.ColumnDefinitions>

                        <ui:Button Grid.Row="0" Grid.Column="0"
                                    x:Name="SelectPatchButton"
                                    Appearance="Secondary"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    Padding="12,8"
                                    Click="SelectPatchFileButton_Click"
                                    ToolTip="Select patch file" Content="选择补丁"/>
                        <ui:TextBox Grid.Row="0" Grid.Column="2"
                                    x:Name="PatchFileTextBox"
                                    VerticalAlignment="Stretch"
                                    VerticalContentAlignment="Center"
                                    IsReadOnly="True"
                                    PlaceholderText="Select a patch file..." />

                        <ui:Button Grid.Row="2" Grid.Column="0"
                                    x:Name="SelectDirButton"
                                    Appearance="Secondary"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    IsEnabled="False"
                                    Padding="12,8"
                                   Click="SelectDirButton_Click"
                                   ToolTip="浏览游戏安装目录">
                            选择目录
                        </ui:Button>

                        <ui:TextBox Grid.Row="2" Grid.Column="2"
                                    x:Name="DirectoryTextBox"
                                    VerticalAlignment="Stretch"
                                    VerticalContentAlignment="Center"
                                    IsReadOnly="True"
                                    PlaceholderText="请选择游戏根目录..." />

                        <ui:Button Grid.Row="2" Grid.Column="6"
                                   Appearance="Primary"
                                   x:Name="RunPatchButton"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    Padding="24,8"
                                    Click="RunPatchButton_Click">
                            应用补丁
                        </ui:Button>

                         <!-- 恢复备份 -->
                         <ui:Button Grid.Column="6"
                                    Appearance="Secondary"
                                    x:Name="RestoreBackupButton"
                                     Style="{StaticResource AnimatedButtonStyle}"
                                     Padding="24,8"
                                    Click="RestoreBackupButton_Click"
                                    ToolTip="选择 .pak 文件恢复备份" HorizontalAlignment="Center">
                             恢复备份
                         </ui:Button>

                         <!-- 补丁信任/签名信息（类似证书） -->
                         <Border Grid.Row="4"
                                 Grid.Column="0"
                                 Grid.ColumnSpan="7"
                                 x:Name="PatchTrustPanel"
                                 Visibility="Collapsed"
                                 CornerRadius="12"
                                 BorderBrush="{DynamicResource CardBorderBrush}"
                                 BorderThickness="1"
                                 Background="{DynamicResource CardBackgroundBrush}">
                             <Border.Effect>
                                 <DropShadowEffect ShadowDepth="2" BlurRadius="12" Opacity="0.06" Direction="270"/>
                             </Border.Effect>
                             <Grid Margin="16">
                                 <Grid.ColumnDefinitions>
                                     <ColumnDefinition Width="Auto"/>
                                     <ColumnDefinition Width="12"/>
                                     <ColumnDefinition Width="*"/>
                                 </Grid.ColumnDefinitions>
 
                                 <Ellipse x:Name="PatchTrustStatusDot"
                                          Width="10"
                                          Height="10"
                                          Fill="{DynamicResource SecondaryTextBrush}"
                                          VerticalAlignment="Top"
                                          Margin="0,4,0,0"/>
 
                                 <StackPanel Grid.Column="2"
                                             Orientation="Vertical">
                                     <TextBlock x:Name="PatchTrustHeaderText"
                                                Text="Patch verification"
                                                FontWeight="Medium"
                                                FontSize="12"
                                                Opacity="0.75"/>
                                     <TextBlock x:Name="PatchTrustStatusText"
                                                Text="Unsigned"
                                                FontWeight="SemiBold"
                                                FontSize="14"
                                                Margin="0,2,0,0"/>
                                     <TextBlock x:Name="PatchTrustSummaryText"
                                                Text="-"
                                                FontSize="12"
                                                Opacity="0.75"
                                                TextWrapping="Wrap"
                                                Margin="0,4,0,0"/>
 
                                     <Grid Margin="0,10,0,0">
                                         <Grid.ColumnDefinitions>
                                             <ColumnDefinition Width="140"/>
                                             <ColumnDefinition Width="*"/>
                                         </Grid.ColumnDefinitions>
                                         <Grid.RowDefinitions>
                                             <RowDefinition Height="Auto"/>
                                             <RowDefinition Height="Auto"/>
                                             <RowDefinition Height="Auto"/>
                                             <RowDefinition Height="Auto"/>
                                             <RowDefinition Height="Auto"/>
                                         </Grid.RowDefinitions>
 
                                         <TextBlock Grid.Row="0" Grid.Column="0"
                                                    x:Name="PatchTrustFieldSourceLabel"
                                                    Text="Source"
                                                    Opacity="0.65"/>
                                         <TextBlock Grid.Row="0" Grid.Column="1"
                                                    x:Name="PatchTrustFieldSourceValue"
                                                    Text="-"
                                                    TextWrapping="Wrap"/>
 
                                         <TextBlock Grid.Row="1" Grid.Column="0"
                                                    x:Name="PatchTrustFieldDistributorLabel"
                                                    Text="Distributor"
                                                    Opacity="0.65"
                                                    Margin="0,2,0,0"/>
                                         <TextBlock Grid.Row="1" Grid.Column="1"
                                                    x:Name="PatchTrustFieldDistributorValue"
                                                    Text="-"
                                                    TextWrapping="Wrap"
                                                    Margin="0,2,0,0"/>
 
                                         <TextBlock Grid.Row="2" Grid.Column="0"
                                                    x:Name="PatchTrustFieldFingerprintLabel"
                                                    Text="Fingerprint"
                                                    Opacity="0.65"
                                                    Margin="0,2,0,0"/>
                                         <TextBox Grid.Row="2" Grid.Column="1"
                                                  x:Name="PatchTrustFieldFingerprintValue"
                                                  Text="-"
                                                  IsReadOnly="True"
                                                  BorderThickness="0"
                                                  Background="Transparent"
                                                  Padding="0"
                                                  FontFamily="Consolas"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource SecondaryTextBrush}"
                                                  TextWrapping="Wrap"
                                                  Margin="0,2,0,0"/>
 
                                         <TextBlock Grid.Row="3" Grid.Column="0"
                                                    x:Name="PatchTrustFieldValidityLabel"
                                                    Text="Validity"
                                                    Opacity="0.65"
                                                    Margin="0,2,0,0"/>
                                         <TextBlock Grid.Row="3" Grid.Column="1"
                                                    x:Name="PatchTrustFieldValidityValue"
                                                    Text="-"
                                                    TextWrapping="Wrap"
                                                    Margin="0,2,0,0"/>
 
                                         <TextBlock Grid.Row="4" Grid.Column="0"
                                                    x:Name="PatchTrustFieldTargetLabel"
                                                    Text="Target"
                                                    Opacity="0.65"
                                                    Margin="0,2,0,0"/>
                                         <TextBlock Grid.Row="4" Grid.Column="1"
                                                    x:Name="PatchTrustFieldTargetValue"
                                                    Text="-"
                                                    TextWrapping="Wrap"
                                                    Margin="0,2,0,0"/>
                                     </Grid>
                                 </StackPanel>
                             </Grid>
                         </Border>

                     </Grid>

                    <!-- 中部：运行日志 -->
                    <Border Grid.Row="2"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource CardBorderBrush}"
                            BorderThickness="1"
                            Background="{DynamicResource CardBackgroundBrush}">
                        <Border.Effect>
                            <DropShadowEffect ShadowDepth="2" BlurRadius="12" Opacity="0.06" Direction="270"/>
                        </Border.Effect>
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal"
                                        Margin="0,0,0,8"
                                        Opacity="0.7">
                                <TextBlock x:Name="RunLogLabel"
                                           Text="运行日志"
                                           FontWeight="Medium"
                                           FontSize="12"/>
                            </StackPanel>
                            <ScrollViewer Grid.Row="1"
                                          x:Name="ConsoleScrollViewer"
                                          VerticalScrollBarVisibility="Auto">
                                <TextBox x:Name="ConsoleTextBox"
                                         IsReadOnly="True"
                                         TextWrapping="Wrap"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         FontFamily="Consolas"
                                         FontSize="13"
                                         Foreground="{DynamicResource SecondaryTextBrush}" />
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- 底部：状态 + 进度条 -->
                    <Grid Grid.Row="4">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Margin="0,0,0,6">
                            <TextBlock x:Name="StatusText"
                                       Text="就绪"
                                       HorizontalAlignment="Left"
                                       FontSize="12"
                                       Opacity="0.6"/>
                            <TextBlock x:Name="ProgressPercentText"
                                       Text="0%"
                                       HorizontalAlignment="Right"
                                       FontSize="12"
                                       Opacity="0.6"
                                       Visibility="Collapsed"/>
                        </Grid>
                        <ProgressBar Grid.Row="1"
                                     x:Name="MainProgressBar"
                                     Height="4"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="0" />
                    </Grid>
                </Grid>

                <!-- 生成页 -->
                <Grid x:Name="GenerateView" Visibility="Collapsed" Opacity="0">
                    <Grid.RenderTransform>
                        <TranslateTransform x:Name="GenerateViewTranslate" Y="15"/>
                    </Grid.RenderTransform>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="10"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="16"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="12"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0"
                          x:Name="GameSelectionPanel"
                          HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ui:Button Grid.Column="0"
                                   x:Name="GameSelectButton"
                                   Appearance="Secondary"
                                   Style="{StaticResource AnimatedButtonStyle}"
                                   Padding="12,8"
                                   Click="GameSelectButton_Click"
                                   Content="游戏选择">
                            <ui:Button.ContextMenu>
                                <ContextMenu x:Name="GameSelectMenu"
                                             MinWidth="200"
                                             Placement="Bottom"/>
                            </ui:Button.ContextMenu>
                        </ui:Button>
                        <TextBlock Grid.Column="2"
                                   x:Name="SelectedGameText"
                                   Text="当前游戏：未选择"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                    </Grid>

                    <!-- 顶部：生成参数 -->
                    <Grid Grid.Row="2"
                          x:Name="GenerateControlsPanel">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- 0: 源目录 -->
                            <RowDefinition Height="10"/>
                            <!-- 1: 间隔 -->
                            <RowDefinition Height="Auto"/>
                            <!-- 2: 目标目录 -->
                            <RowDefinition Height="10"/>
                            <!-- 3: 间隔 -->
                            <RowDefinition Height="Auto"/>
                            <!-- 4: 对目录进行打包 + 开始生成按钮 -->
                            <RowDefinition Height="Auto"/>
                            <!-- 5: 水印开关 -->
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- 修改前目录 -->
                        <ui:Button Grid.Row="0" Grid.Column="0"
                                    x:Name="GenSelectSourceButton"
                                    Appearance="Secondary"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    Padding="12,8"
                                   Content="选择目录"
                                   ToolTip="选择修改前的原始目录"
                                   Click="GenSelectSourceButton_Click "/>
                        <ui:TextBox Grid.Row="0" Grid.Column="2"
                                    x:Name="GenSourceBox"
                                    VerticalAlignment="Stretch"
                                    VerticalContentAlignment="Center"
                                    IsReadOnly="True"
                                    PlaceholderText="选择修改前的目录..." />

                        <!-- 修改后目录 -->
                        <ui:Button Grid.Row="2" Grid.Column="0"
                                    x:Name="GenSelectTargetButton"
                                    Appearance="Secondary"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    Padding="12,8"
                                   Content="选择目录"
                                   ToolTip="选择修改后的输出目录"
                                   Click="GenSelectTargetButton_Click" />
                        <ui:TextBox Grid.Row="2" Grid.Column="2"
                                    x:Name="GenTargetBox"
                                    VerticalAlignment="Stretch"
                                    VerticalContentAlignment="Center"
                                    IsReadOnly="True"
                                    PlaceholderText="选择修改后的目录..." />

                        <!-- 对目录进行打包：切换"目录模式 / 多文件模式"的开关 -->
                        <CheckBox Grid.Row="4" Grid.Column="0"
                                  Grid.ColumnSpan="2"
                                  x:Name="PackDirectoryCheckBox"
                                  Content="对目录进行打包"
                                  Margin="0,4,0,0"
                                  VerticalAlignment="Center"
                                  IsChecked="True"
                                  Style="{StaticResource AnimatedCheckBoxStyle}"
                                  ToolTip="勾选：按目录进行差分打包；取消：按文件列表模式生成差分（后端可根据此值切换逻辑）"/>

                        <CheckBox Grid.Row="5" Grid.Column="0"
                                  Grid.ColumnSpan="2"
                                  x:Name="AddWatermarkCheckBox"
                                  Content="Add Watermark"
                                  Margin="0,2,0,0"
                                  VerticalAlignment="Center"
                                  Style="{StaticResource AnimatedCheckBoxStyle}"
                                  ToolTip="Append watermark text to the end of the generated patch."/>

                        <!-- 开始生成按钮（放在复选框右侧） -->
                        <ui:Button Grid.Row="4" Grid.Column="2"
                                   Grid.RowSpan="2"
                                   x:Name="GenStartDiffButton"
                                   HorizontalAlignment="Right"
                                   VerticalAlignment="Center"
                                   Appearance="Primary"
                                   Style="{StaticResource AnimatedButtonStyle}"
                                   Padding="32,8"
                                   Icon="{ui:SymbolIcon Symbol=Play24}"
                                   Content="开始生成"
                                   Click="GenStartDiffButton_Click" />
                    </Grid>

                    <!-- 中部：生成日志 -->
                    <Border Grid.Row="4"
                            CornerRadius="12"
                            BorderBrush="{DynamicResource CardBorderBrush}"
                            BorderThickness="1"
                            Background="{DynamicResource CardBackgroundBrush}">
                        <Border.Effect>
                            <DropShadowEffect ShadowDepth="2" BlurRadius="12" Opacity="0.06" Direction="270"/>
                        </Border.Effect>
                        <Grid Margin="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal"
                                        Margin="0,0,0,8"
                                        Opacity="0.7">
                                <ui:SymbolIcon Symbol="CodeText20"
                                               FontSize="14"
                                               Margin="0,0,6,0"/>
                                <TextBlock x:Name="GenLogLabel"
                                           Text="生成日志"
                                           FontWeight="Medium"
                                           FontSize="12"/>
                            </StackPanel>
                            <ScrollViewer Grid.Row="1"
                                          x:Name="GenConsoleScrollViewer"
                                          VerticalScrollBarVisibility="Auto">
                                <TextBox x:Name="GenConsoleBox"
                                         IsReadOnly="True"
                                         TextWrapping="Wrap"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         FontFamily="Consolas"
                                         FontSize="13"
                                         Foreground="{DynamicResource SecondaryTextBrush}" />
                            </ScrollViewer>
                        </Grid>
                    </Border>

                    <!-- 底部：状态 + 进度条 -->
                    <Grid Grid.Row="6">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid Margin="0,0,0,6">
                            <TextBlock x:Name="GenStatusText"
                                       Text="等待操作"
                                       HorizontalAlignment="Left"
                                       FontSize="12"
                                       Opacity="0.6"/>
                        </Grid>
                        <ProgressBar Grid.Row="1"
                                     x:Name="GenProgressBar"
                                     Height="4"
                                     Minimum="0"
                                     Maximum="100"
                                     Value="0" />
                    </Grid>
                </Grid>

                <!-- 规则页 -->
                <Grid x:Name="SettingsView" Visibility="Collapsed" Opacity="0">
                    <Grid.RenderTransform>
                        <TranslateTransform x:Name="SettingsViewTranslate" Y="15"/>
                    </Grid.RenderTransform>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0"
                                Orientation="Vertical"
                                Margin="0,0,0,12"
                                Opacity="0.85">
                        <TextBlock x:Name="SettingsTitleText"
                                   Text="设置"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <TextBlock x:Name="LanguageSectionTitle"
                                   Text="语言切换"
                                   FontSize="12"
                                   Opacity="0.7"/>
                    </StackPanel>

                     <Border Grid.Row="1"
                             CornerRadius="12"
                             BorderBrush="{DynamicResource CardBorderBrush}"
                             BorderThickness="1"
                             Background="{DynamicResource CardBackgroundBrush}">
                        <Border.Effect>
                            <DropShadowEffect ShadowDepth="2" BlurRadius="12" Opacity="0.06" Direction="270"/>
                        </Border.Effect>
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled"
                                      Padding="16">
                            <StackPanel Orientation="Vertical">
                                <TextBlock x:Name="AppearanceSectionTitleText"
                                           Text="外观"
                                           FontSize="12"
                                           Opacity="0.7"
                                           Margin="0,0,0,8" />

                                <!-- 主题 -->
                                <Grid Margin="0,0,0,14">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Orientation="Vertical">
                                        <TextBlock x:Name="ThemeSectionLabel"
                                                   Text="切换主题"
                                                   FontSize="13"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <TextBlock x:Name="ThemeSectionDescriptionText"
                                                   Text="切换深色/浅色主题"
                                                   FontSize="12"
                                                   Opacity="0.65"
                                                   Margin="0,2,0,0" />
                                    </StackPanel>

                                    <ToggleButton x:Name="ThemeToggleButton"
                                                  Grid.Column="1"
                                                  Width="100"
                                                  Height="40"
                                                  HorizontalAlignment="Right"
                                                  VerticalAlignment="Center"
                                                  Checked="ThemeToggleButton_CheckedChanged"
                                                  Unchecked="ThemeToggleButton_CheckedChanged"
                                                  Style="{StaticResource ToggleButtonGorgeousThemeSwitchStyle}" />
                                </Grid>

                                <Border Height="1"
                                        Background="{DynamicResource DividerBrush}"
                                        Margin="0,4,0,16"
                                        Opacity="0.6"/>

                                <TextBlock x:Name="LanguageSectionHeaderText"
                                           Text="语言"
                                           FontSize="12"
                                           Opacity="0.7"
                                           Margin="0,0,0,8" />

                                <!-- 界面语言 -->
                                <Grid Margin="0,0,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Orientation="Vertical">
                                        <TextBlock x:Name="LanguageLabel"
                                                   Text="界面语言"
                                                   FontSize="13"
                                                   FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <TextBlock x:Name="LanguageDescriptionText"
                                                   Text="切换界面显示语言"
                                                   FontSize="12"
                                                   Opacity="0.65"
                                                   Margin="0,2,0,0" />
                                    </StackPanel>

                                    <ComboBox x:Name="LanguageSelector"
                                              Grid.Column="1"
                                              Width="160"
                                              HorizontalAlignment="Right"
                                              VerticalAlignment="Center"
                                              SelectedIndex="0"
                                              SelectionChanged="LanguageSelector_SelectionChanged">
                                        <ComboBoxItem Content="中文" Tag="zh_CN" />
                                        <ComboBoxItem Content="English" Tag="en_US" />
                                    </ComboBox>
                                </Grid>

                                <ContentControl x:Name="DebugSettingsHost"
                                                Margin="0,12,0,0" />
                            </StackPanel>
                        </ScrollViewer>
                     </Border>
         </Grid>

                <!-- 密钥页（Debug 下由代码注入内容；Release 不包含密钥功能代码） -->
                <Grid x:Name="KeysViewHost" Visibility="Collapsed" Opacity="0">
                    <Grid.RenderTransform>
                        <TranslateTransform x:Name="KeysViewTranslate" Y="15"/>
                    </Grid.RenderTransform>
                    
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0"
                                    Orientation="Vertical"
                                    Margin="0,0,0,12"
                                    Opacity="0.85">
                            <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.title]}"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,8"/>
                            <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.subtitle]}"
                                       FontSize="12"
                                       Opacity="0.7"/>
                        </StackPanel>

                        <Border Grid.Row="1"
                                CornerRadius="12"
                                BorderBrush="{DynamicResource CardBorderBrush}"
                                BorderThickness="1"
                                Background="{DynamicResource CardBackgroundBrush}">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="16">
                                <StackPanel Orientation="Vertical">

                                    <!-- Section: Publisher Certificate (GroupBox Style) -->
                                    <Border BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="8"
                                            Padding="16"
                                            Margin="0,0,0,20">
                                        <StackPanel>
                                            <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.section.cert]}"
                                                       FontSize="13" FontWeight="SemiBold" Margin="0,0,0,16" Opacity="0.8"/>

                                            <!-- Source -->
                                            <Grid Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.source.label]}"
                                                           VerticalAlignment="Center" Opacity="0.8"/>
                                                <ui:TextBox Grid.Column="1" x:Name="CertSourceBox"
                                                            PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.source.placeholder]}"/>
                                            </Grid>

                                            <!-- Distributor -->
                                            <Grid Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.distributor.label]}"
                                                           VerticalAlignment="Center" Opacity="0.8"/>
                                                <ui:TextBox Grid.Column="1" x:Name="CertDistributorBox"
                                                            PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.distributor.placeholder]}"/>
                                            </Grid>

                                            <!-- Serial -->
                                            <Grid Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.serial.label]}"
                                                           VerticalAlignment="Center" Opacity="0.8"/>
                                                <ui:TextBox Grid.Column="1" x:Name="CertSerialBox"
                                                            PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.serial.placeholder]}"/>
                                            </Grid>

                                            <!-- Valid From -->
                                            <Grid Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.validFrom.label]}"
                                                           VerticalAlignment="Center" Opacity="0.8"/>
                                                <DatePicker Grid.Column="1" x:Name="CertValidFromPicker"
                                                            SelectedDate="{x:Static sys:DateTime.Today}"/>
                                            </Grid>

                                            <!-- Valid To -->
                                            <Grid Margin="0,0,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="140"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.cert.validTo.label]}"
                                                           VerticalAlignment="Center" Opacity="0.8"/>
                                                <DatePicker Grid.Column="1" x:Name="CertValidToPicker"/>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- Section: Keypair -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.section.keypair]}"
                                               FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Opacity="0.8"/>

                                    <!-- Fingerprint + Generate Button -->
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox x:Name="KeysFingerprintBox"
                                                    IsReadOnly="True"
                                                    PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.keypair.fingerprint.placeholder]}"
                                                    FontFamily="Consolas"
                                                    FontSize="12"/>
                                        <ui:Button Grid.Column="2"
                                                   Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.generate]}"
                                                   Appearance="Primary"
                                                   Style="{StaticResource AnimatedButtonStyle}"
                                                   Click="KeysGenerateButton_Click"
                                                   Padding="24,8"/>
                                    </Grid>

                                    <!-- Key Action Buttons -->
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                        <ui:Button Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.createCert]}"
                                                   Appearance="Primary"
                                                   Style="{StaticResource AnimatedButtonStyle}"
                                                   Click="KeysSaveCertButton_Click"
                                                   Margin="0,0,8,0"/>
                                        <ui:Button Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.importCert]}"
                                                   Appearance="Secondary"
                                                   Style="{StaticResource AnimatedButtonStyle}"
                                                   Click="KeysLoadCertButton_Click"
                                                   Margin="0,0,8,0"/>
                                        <ui:Button Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.saveKey]}"
                                                   Appearance="Secondary"
                                                   Style="{StaticResource AnimatedButtonStyle}"
                                                   Click="KeysSaveKeyButton_Click"
                                                   Margin="0,0,8,0"/>
                                        <ui:Button Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.loadKey]}"
                                                   Appearance="Secondary"
                                                   Style="{StaticResource AnimatedButtonStyle}"
                                                   Click="KeysLoadKeyButton_Click"/>
                                    </StackPanel>

                                    <Border Height="1" Background="{DynamicResource DividerBrush}" Opacity="0.5" Margin="0,0,0,20"/>

                                    <!-- Section: Sign Patch -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.section.sign]}"
                                               FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Opacity="0.8"/>

                                    <!-- Patch Input -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.patch.label]}"
                                               Opacity="0.7" Margin="0,0,0,4"/>
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox x:Name="SignPatchInputBox" PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.patch.placeholder]}" IsReadOnly="True"/>
                                        <ui:Button Grid.Column="2" Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.browse]}" Style="{StaticResource AnimatedButtonStyle}" Click="SignBrowsePatch_Click"/>
                                    </Grid>

                                    <!-- Target (original file/directory for hash verification) -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.target.label]}"
                                               Opacity="0.7" Margin="0,0,0,4"/>
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox x:Name="SignTargetBox" PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.target.placeholder]}" IsReadOnly="True"/>
                                        <ui:Button Grid.Column="2" Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.browse]}" Style="{StaticResource AnimatedButtonStyle}" Click="SignBrowseTarget_Click"/>
                                    </Grid>

                                    <!-- Output -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.output.label]}"
                                               Opacity="0.7" Margin="0,0,0,4"/>
                                    <Grid Margin="0,0,0,12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="8"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ui:TextBox x:Name="SignOutputBox" PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.output.placeholder]}" IsReadOnly="True"/>
                                        <ui:Button Grid.Column="2" Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.button.browse]}" Style="{StaticResource AnimatedButtonStyle}" Click="SignBrowseOutput_Click"/>
                                    </Grid>

                                    <!-- Notes -->
                                    <TextBlock Text="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.notes.label]}"
                                               Opacity="0.7" Margin="0,0,0,4"/>
                                    <ui:TextBox x:Name="SignNotesBox"
                                                PlaceholderText="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.notes.placeholder]}"
                                                Height="60"
                                                AcceptsReturn="True"
                                                TextWrapping="Wrap"
                                                VerticalScrollBarVisibility="Auto"
                                                Margin="0,0,0,12"/>

                                    <!-- Sign Button -->
                                    <ui:Button Content="{Binding Source={x:Static local:LocalizationManager.Instance}, Path=[keys.sign.button]}"
                                               Appearance="Primary"
                                               Style="{StaticResource AnimatedButtonStyle}"
                                               Icon="{ui:SymbolIcon Symbol=Pen24}"
                                               Click="SignExecuteButton_Click"
                                               HorizontalAlignment="Right"
                                               Padding="24,8"/>

                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Grid>

    </Grid>
        </Grid>

        <!-- Theme transition overlay (masks instant WPF-UI theme resource swaps) -->
        <!-- 必须放在 RootGrid 的直接子元素位置，覆盖整个窗口 -->
        <Grid x:Name="ThemeTransitionOverlay"
              Grid.RowSpan="2"
              Background="Transparent"
              Visibility="Collapsed"
              Opacity="0"
              IsHitTestVisible="False">
            <Image x:Name="ThemeTransitionImage"
                   Stretch="Fill"
                   SnapsToDevicePixels="True" />
        </Grid>
    </Grid>
</ui:FluentWindow>
